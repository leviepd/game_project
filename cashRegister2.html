<!DOCTYPE html>

<html>

<head>

<p>Cash Register</p>

Enter Item, Quantity: <input id=command onchange="input_data(this)">

<div id=output></div>

</head>

<body>
<script src=db.js></script>

<script>

write = function(s) {
	var h = document.getElementById("output").innerHTML;
	document.getElementById("output").innerHTML = h + "<br>" + s;
	// why is <br> in quatations??
}


db = new DB(user, pass);

save_order(order) {
	db.sql("insert into orders (customer, order) values(?, ?)", [order.customer, o2j(order)], function(err) {
		if(err) {
			alert("Save Error: "+err);
		}
	});
}


// Data 

snes = {
	name: "snes",
	price: 75,
};

sega = {
	name: "sega",
	price: 40,
};

gamecube = {
	name: "gamecube",
	price: 40,
};

ps1 = {
	name: "ps1",
	price: 40,
};

products = [snes, sega, gamecube, ps1];

// Order Holds The Data

order = {
	byName: [], // contains orders byname
}

// Do's... If type customer name, then create a new order
// When finished with the order store the order in seperate location (maybe an array for now)
// Be able to clear the order

// Inputs handle_data into HTML

function input_data(element) {
	handle_data(element.value);
	element.value = "";
	element.scrollIntoView();
}
function new_order(a) {
	a = {
		customer: a,
		lines: [], // product, qty, sub
		tote: "",
	}
	norder = a;
	write(norder.customer);
}


// Prints Item, Cost.
// Calculates Item's Subtotal

function sub_total(prod) {
	write("Product: " + prod.name);
	write("Price: " + prod.price);
	var l = {
		product: prod,
		qty: num,
		sub: prod.price * num,
	}
	// l for "lines"...
	norder.lines.push(l);
	// pushes l into "lines" array.
}

// Calculates Order Total

total = 0;

calc = true;

calcTot = function() {
	if(calc === true) {
	var i;
	for(var i = 0; i < norder.lines.length; i++) {
		total += norder.lines[i].sub;
	}
	norder.tote = total;
	write("");
	write("Customer: " + norder.customer);
	write("Total: " + total);
	
	order.byName.push(norder);
	}
};

// Handles the Data

no = 0;

handle_data = function(data) {
	data = data.toLowerCase();
	data = data.split(" ");  // ["", ""]
	entry = data[0];
	num = parseInt(data[1]);

	var i;
	for(i = 0; i < products.length; i++) {
		var prod = products[i];
	if(entry === prod.name) {
		if(num === undefined) {
			write("You have to enter the item, and the item's quantity.");
		}
		else { // num is defined
			sub_total(prod);
		}
	}
	}
	if(entry === "customer") {
		num = data[1];
		no = 1;
	}
	else
	if(no === 1) {
		new_order(entry);
		num = parseInt(data[1]);
		no = 0;
	}
	else
	if(entry === "subtotal") {
		var i;
		for(i = 0; i < norder.lines.length; i++) {
			write("");
			write("Product: " + norder.lines[i].product.name);
			write("Quantity: " + norder.lines[i].qty);
			write("Subtotal: " + norder.lines[i].sub);
		}
	}
	else 
	if(entry === "total") {
		calcTot();
		calc = false;
	}
};



</script>

</body>

</html>



